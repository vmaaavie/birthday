<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>üíå letters</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#031628; --paper:#fff; --text:#374151;
    --wrap:#f5edd1; --flap:#ecdeb8; --body:#e6cfa7;
    --accent:#f59e0b; --btn:#fbbf24; --btn-hover:#fcd34d;
    --seal:#541717;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
  header{max-width:1100px;margin:24px auto 8px;padding:0 16px}
  h1{margin:0 0 10px}
  .meta{opacity:.9;margin:0 0 10px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .btn{padding:10px 14px;border:0;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.primary{background:#000000;color:#fff}
  .btn.primary:hover{background:#000000}
  .btn.light{background:#f3f4f6;color:#111}

  /* Grid */
  .grid{
    max-width:1100px; margin:18px auto 48px; padding:0 16px;
    display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
    gap:20px;
  }

  /* Karte */
  .card{
    background:var(--wrap);
    border:2px solid var(--accent);
    border-radius:14px;
    padding:16px;
    color:#111;
    display:flex; 
    flex-direction:column;
    gap:16px;
    transition:opacity .2s ease;
    min-height:280px;
  }
  .card.locked{opacity:.4; filter:grayscale(50%)}

  /* Umschlag Container */
  .envelope{
    position:relative;
    width: 100%;
    height:180px;
    background:var(--body);
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 4px 8px rgba(0,0,0,.15);
  }

  /* Brief-Inhalt - versteckt bis ge√∂ffnet */
  .letter{
    position:absolute;
    top:15px; left:15px; right:15px; bottom:15px;
    background:var(--paper);
    color:var(--text);
    border-radius:6px;
    padding:16px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
    z-index:1;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    opacity:0;
    transform:scale(0.8);
    transition:all 0.5s ease;
  }
  .letter p{
    margin:0;
    font-size:14px;
    line-height:1.5;
  }

  /* Umschlag-K√∂rper */
  .envelope-body{
    position:absolute;
    top:80px; left:0; right:0; bottom:0;
    background:var(--body);
    border-radius:0 0 10px 10px;
    z-index:2;
    transition:transform 0.6s ease;
  }

  /* Umschlag-Klappe mit Siegel */
  .envelope-flap{
    position:absolute;
    top:0; left:0; right:0;
    height:100px;
    background:var(--flap);
    clip-path:polygon(0% 0%, 100% 0%, 50% 80%);
    z-index:3;
    transition:transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    transform-origin:top center;
  }

  /* Herz-Siegel auf der Klappe */
  .seal{
    position:absolute;
    top:65px;
    left:50%;
    width:22px;
    height:22px;
    background:var(--seal);
    transform:translate(-50%, -50%) rotate(45deg);
    border-radius:3px 0;
    box-shadow:0 3px 8px rgba(251, 24, 227, 0.6);
  }
  .seal::before,
  .seal::after {
    content:'';
    position:absolute;
    width:22px;
    height:22px;
    background:var(--seal);
    border-radius:50%;
  }
  .seal::before { top:-11px; left:0; }
  .seal::after { top:0; left:-11px; }

  /* Ge√∂ffneter Zustand */
  .card.opened .envelope-flap{
    transform:rotateX(-180deg);
  }
  .card.opened .envelope-body{
    transform:translateY(100%);
  }
  .card.opened .letter{
    opacity:1;
    transform:scale(1);
    transition-delay:0.4s;
  }

  /* Footer */
  .card-footer{
    display:flex; 
    gap:12px; 
    align-items:center; 
    justify-content:space-between;
  }
  .card-title{
    margin:0; 
    font-size:16px; 
    font-weight:800; 
    color:#111;
    display:flex; 
    align-items:center; 
    gap:8px;
  }
  .badge{
    font-size:11px; 
    font-weight:700; 
    color:#111;
    background:#fde68a; 
    border:1px dashed var(--accent);
    padding:3px 8px; 
    border-radius:12px;
  }
  .toggle-btn{
    padding:8px 12px;
    border:0; 
    border-radius:8px; 
    font-weight:700; 
    cursor:pointer;
    background:var(--btn);
    font-size:13px;
    transition:all .2s ease;
  }
  .toggle-btn:hover:not(:disabled){
    background:var(--btn-hover);
    transform:translateY(-1px);
  }
  .toggle-btn:disabled{opacity:0.5; cursor:not-allowed; background:#999;}

  @media (max-width: 768px) {
    .grid{
      grid-template-columns:1fr;
    }
  }
</style>

<style>
:root{
  --ink:#e5e7eb; --muted:#9ca3af;
  --panel:rgba(255,255,255,0.06); --border:rgba(255,255,255,0.12);
}
body{background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
.topnav{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);background:rgba(255,255,255,0.06);border-bottom:1px solid var(--border)}
.topnav .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}
.topnav .links{display:flex;gap:10px;flex-wrap:wrap}
.topnav .links a{display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.2);text-decoration:none;color:#e5e7eb;background:rgba(0,0,0,0.25);font-weight:700}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.2);font-weight:700;color:#e5e7eb}
</style>

</head>
<body>

<header class="topnav">
  <div class="wrap">
    <nav class="links">
      <a href="index.html">Home</a>
      <a href="minigames.html">Minigames</a>
      <a href="quests.html">Quests</a>
      <a href="shop.html">Shop</a>
    </nav>
    <div class="pill">ü™ô Coins: <span id="coinCount">0</span></div>
  </div>
</header>


<header>
  <h1>üíå ùêãùêûùê≠ùê≠ùêûùê´ùê¨ ùêüùê®ùê´ ùê≤ùê®ùêÆ <ùüë</h1>
  <div class="meta" id="meta">‚Äì</div>
  <div class="actions">
    <button id="reset" class="btn light">reset progress</button>
  </div>
</header>

<section class="grid" id="grid"></section>


<script>
(() => {
  // --- Shared store ---
  const store = {
    get coins(){ return parseInt(localStorage.getItem('ldg_coins')||'0',10) },
    set coins(v){ localStorage.setItem('ldg_coins', String(v)); const hud=document.getElementById('coinCount'); if(hud) hud.textContent=String(v); },
    get purchases(){ return JSON.parse(localStorage.getItem('ldg_purchases')||'{}') },
    set purchases(v){ localStorage.setItem('ldg_purchases', JSON.stringify(v)) },
  };
  function buy(id, price){ if(store.coins < price) return false; const p=store.purchases; store.coins = store.coins - price; p[id]=true; store.purchases=p; return true; }
  function owns(id){ return !!store.purchases[id]; }

  const LETTER_PRICE = 15;
  const MESSAGES = [
    "ùê∞ùê¢ùê≠ùê° ùê≤ùê®ùêÆ, ùêûùêØùêûùê´ùê≤ùê≠ùê°ùê¢ùêßùê† ùê¢ùêß ùê•ùê¢ùêüùêû ùêüùêûùêûùê•ùê¨ ùê¨ùê® ùê¶ùêÆùêúùê° ùêûùêöùê¨ùê¢ùêûùê´","ùê≤ùê®ùêÆùê´ùêû ùê≠ùê°ùêû ùê´ùêûùêöùê¨ùê®ùêß ùêûùêØùêûùêß ùêùùê¢ùêüùêüùê¢ùêúùêÆùê•ùê≠ ùêùùêöùê≤ùê¨ ùêüùêûùêûùê• ùê©ùê®ùê¨ùê¨ùê¢ùêõùê•ùêû","ùê≤ùê®ùêÆùê´ ùê©ùê´ùêûùê¨ùêûùêßùêúùêû ùêüùêûùêûùê•ùê¨ ùê•ùê¢ùê§ùêû ùêö ùê°ùê®ùê¶ùêû ùê¢ ùêßùêûùêØùêûùê´ ùê∞ùêöùêßùê≠ ùê≠ùê® ùê•ùêûùêöùêØùêû","ùê≤ùê®ùêÆ ùê¶ùêöùê§ùêû ùê•ùê¢ùêüùêû ùê¨ùê∞ùêûùêûùê≠ùêûùê´ ùê£ùêÆùê¨ùê≠ ùêõùê≤ ùêûùê±ùê¢ùê¨ùê≠ùê¢ùêßùê†","ùê¢ùê¶ ùê¨ùê® ùê†ùê•ùêöùêù ùê¢ ùê†ùêûùê≠ ùê≠ùê® ùê•ùê®ùêØùêû ùê≤ùê®ùêÆ","ùê∞ùê°ùêûùêß ùê¢ ùê•ùê®ùê®ùê§ ùêöùê≠ ùê≤ùê®ùêÆ, ùê¶ùê≤ ùê°ùêûùêöùê´ùê≠ ùêüùêûùêûùê•ùê¨ ùê•ùê¢ùê§ùêû ùêö ùêüùê¢ùê´ùêûùê∞ùê®ùê´ùê§","ùêûùêØùêûùêß ùê¢ùêß ùê¶ùê≤ ùêùùê´ùêûùêöùê¶ùê¨, ùê¢ ùê•ùê®ùê®ùê§ ùêüùê®ùê´ ùê≤ùê®ùêÆ","ùê¢ ùê∞ùê®ùêÆùê•ùêù ùêúùê°ùê®ùê®ùê¨ùêû ùê≤ùê®ùêÆùê´ ùê©ùê´ùêûùê¨ùêûùêßùêúùêû ùê®ùêØùêûùê´ ùêöùêßùê≤ ùê©ùêûùê´ùêüùêûùêúùê≠ ùê©ùê•ùêöùêúùêû","ùê≤ùê®ùêÆùê´ùêû ùê¶ùê≤ ùêüùêöùêØùê®ùê´ùê¢ùê≠ùêû ùê©ùêöùê´ùê≠ ùê®ùêü ùêûùêØùêûùê´ùê≤ ùêùùêöùê≤","ùê¢ ùêùùê®ùêßùê≠ ùê£ùêÆùê¨ùê≠ ùê•ùê®ùêØùêû ùê∞ùê°ùêöùê≠ ùê≤ùê®ùêÆ ùêùùê® ùêüùê®ùê´ ùê¶ùêû, ùê¢ ùê•ùê®ùêØùêû ùê∞ùê°ùê® ùê≤ùê®ùêÆ ùêöùê´ùêû",
    "ùêõùêûùê¢ùêßùê† ùê∞ùê¢ùê≠ùê° ùê≤ùê®ùêÆ ùêúùê®ùêÆùê•ùêù ùêßùêûùêØùêûùê´ ùêõùêû ùêö ùê∞ùêöùê¨ùê≠ùêû ùê®ùêü ùê≠ùê¢ùê¶ùêû","ùêûùêØùêûùê´ùê≤ ùê≠ùê¢ùê¶ùêû ùê≤ùê®ùêÆ ùê¨ùê¶ùê¢ùê•ùêû ùêöùê≠ ùê¶ùêû, ùê¢ ùêüùêûùêûùê• ùê•ùê¢ùê§ùêû ùê≠ùê°ùêû ùê•ùêÆùêúùê§ùê¢ùêûùê¨ùê≠ ùê©ùêûùê´ùê¨ùê®ùêß ùêöùê•ùê¢ùêØùêû","ùêûùêØùêûùêß ùê®ùêß ùêúùê•ùê®ùêÆùêùùê≤ ùêùùêöùê≤ùê¨, ùê≤ùê®ùêÆùê´ùêû ùê¶ùê≤ ùê¨ùêÆùêßùê¨ùê°ùê¢ùêßùêû","ùê¢ ùê∞ùê®ùêÆùê•ùêù ùê¨ùêûùêöùê´ùêúùê° ùêüùê®ùê´ ùê≤ùê®ùêÆùê´ ùê¨ùê®ùêÆùê• ùê¢ùêß ùêöùêßùê≤ ùê•ùê¢ùêüùêûùê≠ùê¢ùê¶ùêû","ùê≤ùê®ùêÆ ùêöùê´ùêû ùê≠ùê°ùêû ùêúùêöùê•ùê¶ ùê¢ùêß ùê¶ùê≤ ùê¨ùê≠ùê®ùê´ùê¶ùê¨ ùêöùêßùêù ùê≠ùê°ùêû ùê•ùê¢ùê†ùê°ùê≠ ùê¢ùêß ùê¶ùê≤ ùêùùêöùê´ùê§ùêßùêûùê¨ùê¨","ùê≠ùê°ùê¢ùêßùê§ùê¢ùêßùê† ùê®ùêü ùê≤ùê®ùêÆ ùê¶ùêöùê§ùêûùê¨ ùê¶ùê≤ ùê°ùêûùêöùê´ùê≠ ùê¶ùêûùê•ùê≠","ùêûùêØùêûùê´ùê≤ ùê≠ùê¢ùê¶ùêû ùêà ùê¨ùêûùêû ùê≤ùê®ùêÆ, ùê¢ ùêüùêöùê•ùê• ùê¢ùêß ùê•ùê®ùêØùêû ùê∞ùê¢ùê≠ùê° ùê≤ùê®ùêÆ ùêöùê†ùêöùê¢ùêß","ùê¢ùêü ùê≤ùê®ùêÆùê´ ùêØùê®ùê¢ùêúùêû ùê∞ùêöùê¨ ùêö ùê¨ùê®ùêßùê†, ùê¢ ùê∞ùê®ùêÆùê•ùêù ùê•ùê¢ùê¨ùê≠ùêûùêß ùê≠ùê® ùê¢ùê≠ ùê®ùêß ùê´ùêûùê©ùêûùêöùê≠ ùêüùê®ùê´ ùê≠ùê°ùêû ùê´ùêûùê¨ùê≠ ùê®ùêü ùê¶ùê≤ ùê•ùê¢ùêüùêû","ùê≤ùê®ùêÆùê´ùêû ùê≠ùê°ùêû ùêüùê¢ùê´ùê¨ùê≠ ùê©ùêûùê´ùê¨ùê®ùêß ùê∞ùê°ùê® ùê°ùêöùê¨ ùêûùêØùêûùê´ ùê¶ùêöùêùùêû ùê¶ùêû ùêüùêûùêûùê• ùê≠ùê´ùêÆùê•ùê≤ ùê•ùê®ùêØùêûùêù","ùê≤ùê®ùêÆ ùê¶ùêöùê§ùêû ùê®ùê´ùêùùê¢ùêßùêöùê´ùê≤ ùê¶ùê®ùê¶ùêûùêßùê≠ùê¨ ùêûùê±ùê≠ùê´ùêöùê®ùê´ùêùùê¢ùêßùêöùê´ùê≤ ùê£ùêÆùê¨ùê≠ ùêõùê≤ ùêõùêûùê¢ùêßùê† ùê¢ùêß ùê≠ùê°ùêûùê¶",
    "ùêöùê•ùê• ùê≤ùê®ùêÆùê´ ùêüùêÆùêßùêßùê≤ ùêöùêßùêù ùêöùêÆùê≠ùê¢ùê¨ùê≠ùê¢ùêú ùê¶ùê®ùê¶ùêûùêßùê≠ùê¨ ùê¶ùêöùê§ùêû ùê≤ùê®ùêÆ ùêûùêØùêûùêß ùê¶ùê®ùê´ùêû ùê•ùê®ùêØùêûùêöùêõùê•ùêû ùê≠ùê® ùê¶ùêû","ùêûùêØùêûùêß ùê¢ùêü ùê≤ùê®ùêÆ ùêùùê¢ùêù ùêßùê®ùê≠ùê°ùê¢ùêßùê† ùêöùê≠ ùêöùê•ùê•, ùê≤ùê®ùêÆ ùê∞ùê®ùêÆùê•ùêù ùê¨ùê≠ùê¢ùê•ùê• ùêõùêû ùêöùê¶ùêöùê≥ùê¢ùêßùê†, ùê£ùêÆùê¨ùê≠ ùêõùêûùêúùêöùêÆùê¨ùêû ùê≤ùê®ùêÆ ùêöùê´ùêû ùê≤ùê®ùêÆ","ùêûùêØùêûùêß ùê®ùêß ùê¶ùê≤ ùê°ùêöùê©ùê©ùê¢ùêûùê¨ùê≠ ùêùùêöùê≤ùê¨, ùê≤ùê®ùêÆùê´ùêû ùê¨ùê≠ùê¢ùê•ùê• ùê≠ùê°ùêû ùêõùêûùê¨ùê≠ ùê©ùêöùê´ùê≠ ùê®ùêü ùê≠ùê°ùêûùê¶","ùêõùêûùê¢ùêßùê† ùê•ùê®ùêØùêûùêù ùêõùê≤ ùê≤ùê®ùêÆ ùê¢ùê¨ ùê≠ùê°ùêû ùêõùêûùê¨ùê≠ ùê†ùê¢ùêüùê≠ ùê•ùê¢ùêüùêû ùê°ùêöùê¨ ùêûùêØùêûùê´ ùê†ùê¢ùêØùêûùêß ùê¶ùêû","ùêõùêûùê¢ùêßùê† ùê∞ùê¢ùê≠ùê° ùê≤ùê®ùêÆ ùê¶ùêöùê§ùêûùê¨ ùê¶ùêû ùêüùêûùêûùê• ùê¨ùêöùêüùêû ùê¢ùêß ùê≠ùê°ùê¢ùê¨ ùêúùê°ùêöùê®ùê≠ùê¢ùêú ùê∞ùê®ùê´ùê•ùêù","ùê≤ùê®ùêÆùê´ ùê•ùêöùêÆùê†ùê° ùêöùêßùêù ùê≠ùê°ùêöùê≠ ùê•ùê¢ùê≠ùê≠ùê•ùêû ùê†ùê¢ùê†ùê†ùê•ùêû ùêöùê´ùêû ùê•ùê¢ùê§ùêû ùê¶ùêÆùê¨ùê¢ùêú ùê≠ùê® ùê¶ùê≤ ùê¨ùê®ùêÆùê•","ùêûùêØùêûùê´ùê≤ ùêßùê¢ùê†ùê°ùê≠ ùê∞ùê°ùêûùêß ùê¢ ùê†ùê® ùê≠ùê® ùêõùêûùêù, ùê¢ ùê°ùê®ùê©ùêû ùê≠ùê°ùêöùê≠ ùê¢ ùêùùê´ùêûùêöùê¶ ùê®ùêü ùê≤ùê®ùêÆ","ùê∞ùêû ùêúùê®ùêÆùê•ùêù ùê¨ùê¢ùê≠ ùê¢ùêß ùê¨ùê¢ùê•ùêûùêßùêúùêû ùêüùê®ùê´ ùê°ùê®ùêÆùê´ùê¨ ùêöùêßùêù ùê¢ ùê∞ùê®ùêÆùê•ùêù ùê¨ùê≠ùê¢ùê•ùê• ùêöùê©ùê©ùê´ùêûùêúùê¢ùêöùê≠ùêû ùêûùêØùêûùê´ùê≤ ùê¨ùêûùêúùê®ùêßùêù","ùê¢ ùêöùê¶ ùêßùêûùêØùêûùê´ ùêßùê®ùê≠ ùê≠ùê°ùê¢ùêßùê§ùê¢ùêßùê† ùêöùêõùê®ùêÆùê≠ ùê≤ùê®ùêÆ, ùê≤ùê®ùêÆùê´ùêû ùêöùê•ùê∞ùêöùê≤ùê¨ ùê®ùêß ùê¶ùê≤ ùê¶ùê¢ùêßùêù","ùê°ùêûùêöùê´ùê¢ùêßùê† ùê≤ùê®ùêÆùê´ ùêØùê®ùê¢ùêúùêû ùêüùêûùêûùê•ùê¨ ùê•ùê¢ùê§ùêû ùêö ùê∞ùêöùê´ùê¶ ùê¨ùêÆùê¶ùê¶ùêûùê´ ùêõùê´ùêûùêûùê≥ùêû",
    "ùê¢ ùê∞ùê¢ùê•ùê• ùêßùêûùêØùêûùê´ ùê¨ùê≠ùê®ùê© ùêõùêûùê¢ùêßùê† ùê†ùê´ùêöùê≠ùêûùêüùêÆùê• ùêüùê®ùê´ ùê≤ùê®ùêÆ. ùêßùê®ùê≠ ùê£ùêÆùê¨ùê≠ ùêüùê®ùê´ ùê∞ùê°ùêöùê≠ ùê≤ùê®ùêÆ ùêùùê®, ùêõùêÆùê≠ ùêüùê®ùê´ ùê∞ùê°ùê® ùê≤ùê®ùêÆ ùêöùê´ùêû","ùê¢ùêü ùê¨ùê®ùêÆùê•ùê¨ ùê∞ùêûùê´ùêû ùê¨ùê≠ùêöùê´ùê¨, ùê≤ùê®ùêÆùê´ùê¨ ùê∞ùê®ùêÆùê•ùêù ùêõùêû ùê≠ùê°ùêû ùê®ùêßùêû ùêõùê´ùê¢ùê†ùê°ùê≠ùêûùê¨ùê≠ ùê®ùêßùêû ùê¢ùêß ùê≠ùê°ùêû ùêßùê¢ùê†ùê°ùê≠ ùê¨ùê§ùê≤","ùêûùêØùêûùê´ùê≤ ùê©ùêöùê´ùê≠ ùê®ùêü ùê≤ùê®ùêÆ ùê¢ùê¨ ùê∞ùê®ùê´ùê≠ùê° ùê•ùê®ùêØùê¢ùêßùê†, ùêüùê´ùê®ùê¶ ùê≤ùê®ùêÆùê´ ùêØùê®ùê¢ùêúùêû ùê≠ùê® ùê≤ùê®ùêÆùê´ ùê¨ùê¶ùê¢ùê•ùêû ùê≠ùê® ùê≤ùê®ùêÆùê´ ùê¨ùê®ùêÆùê•","ùê≤ùê®ùêÆùê´ ùê¨ùê¶ùê¢ùê•ùêû ùê¢ùê¨ ùê©ùêÆùê´ùêû ùê¨ùêÆùêßùê¨ùê°ùê¢ùêßùêû ùê≠ùê® ùê¶ùêû","ùê≤ùê®ùêÆùê´ ùêûùê±ùê¢ùê¨ùê≠ùêûùêßùêúùêû ùêöùê•ùê®ùêßùêû ùê¶ùêöùê§ùêûùê¨ ùê¶ùê≤ ùê•ùê¢ùêüùêû ùêõùê´ùê¢ùê†ùê°ùê≠ùêûùê´","ùêûùêØùêûùêß ùê≠ùê°ùêû ùê¨ùê¶ùêöùê•ùê•ùêûùê¨ùê≠ ùê¶ùê®ùê¶ùêûùêßùê≠ùê¨ ùê∞ùê¢ùê≠ùê° ùê≤ùê®ùêÆ ùêüùêûùêûùê• ùê•ùê¢ùê§ùêû ùêö ùê¶ùêûùê¶ùê®ùê´ùê≤ ùê≠ùê°ùêöùê≠ùê¨ ùê∞ùê®ùê´ùê≠ùê° ùê§ùêûùêûùê©ùê¢ùêßùê† ùêüùê®ùê´ùêûùêØùêûùê´","ùê≠ùê°ùêû ùê∞ùêöùê≤ ùê≤ùê®ùêÆ ùêöùê´ùêû ùê¢ùê¨ ùê¶ùê®ùê´ùêû ùê≠ùê°ùêöùêß ùê¢ ùêúùê®ùêÆùê•ùêù ùêûùêØùêûùê´ ùêùùê´ùêûùêöùê¶ ùê®ùêü",
    "ùê≤ùê®ùêÆ ùê†ùê¢ùêØùêû ùê¶ùêû ùê°ùêöùê©ùê©ùê¢ùêßùêûùê¨ùê¨ ùê¢ ùê≠ùê°ùê®ùêÆùê†ùê°ùê≠ ùê¢ ùêúùê®ùêÆùê•ùêù ùê®ùêßùê•ùê≤ ùê°ùêöùêØùêû ùêöùê¨ ùêö ùê§ùê¢ùêù","ùê≤ùê®ùêÆ ùêöùê´ùêû ùê≠ùê°ùêû ùêõùêûùê¨ùê≠ ùêùùêûùêúùê¢ùê¨ùê¢ùê®ùêß ùê¶ùê≤ ùê°ùêûùêöùê´ùê≠ ùêûùêØùêûùê´ ùê¶ùêöùêùùêû","ùê¢ùêü ùêöùêßùê≤ùê®ùêßùêû ùêöùê¨ùê§ùêûùêù ùê¶ùêû ùêöùêõùê®ùêÆùê≠ ùê•ùê®ùêØùêû, ùê¢ ùê∞ùê®ùêÆùê•ùêù ùê≠ùêûùê•ùê• ùê≠ùê°ùêûùê¶ ùêöùêõùê®ùêÆùê≠ ùê≤ùê®ùêÆ"
  ];

  const grid = document.getElementById('grid');
  const meta = document.getElementById('meta');

  function countUnlocked(){
    const p = store.purchases; let cnt=0; for(const k in p){ if(k.startsWith('letter-') && p[k]) cnt++; } return cnt;
  }

  function updateMeta(){
    const cnt = countUnlocked();
    if(meta) meta.textContent = `unlocked: ${Math.min(cnt, MESSAGES.length)} / ${MESSAGES.length} (Score: ${cnt})`;
  }

  function render(){
    grid.innerHTML='';
    MESSAGES.forEach((message, index) => {
      const id = `letter-${index+1}`; const isUnlocked = owns(id);

      const card = document.createElement('div');
      card.className = 'card' + (isUnlocked ? '' : ' locked');

      const envelope = document.createElement('div'); envelope.className = 'envelope';
      const letter = document.createElement('div'); letter.className = 'letter';
      const letterText = document.createElement('p'); letterText.textContent = message; letter.appendChild(letterText);
      const envelopeBody = document.createElement('div'); envelopeBody.className = 'envelope-body';
      const envelopeFlap = document.createElement('div'); envelopeFlap.className = 'envelope-flap';
      const seal = document.createElement('div'); seal.className = 'seal'; envelopeFlap.appendChild(seal);
      envelope.appendChild(letter); envelope.appendChild(envelopeBody); envelope.appendChild(envelopeFlap);

      const footer = document.createElement('div'); footer.className = 'card-footer';
      const title = document.createElement('h3'); title.className = 'card-title';
      const badge = `<span class="badge">${isUnlocked ? 'unlocked' : 'locked'}</span>`;
      title.innerHTML = `letter ${index + 1} ${badge}`;

      const button = document.createElement('button'); button.className = 'toggle-btn';

      function makeOpenButton(){
        button.textContent = 'open';
        button.disabled = false;
        let isOpen = false;
        button.onclick = () => {
          isOpen = !isOpen;
          if (isOpen) { card.classList.add('opened'); button.textContent = 'close'; }
          else { card.classList.remove('opened'); button.textContent = 'open'; }
        };
      }

      if (!isUnlocked) {
        button.textContent = `buy (ü™ô ${LETTER_PRICE})`;
        button.disabled = store.coins < LETTER_PRICE;
        button.onclick = () => {
          if (buy(id, LETTER_PRICE)) {
            // Unlock UI
            card.classList.remove('locked');
            title.innerHTML = `letter ${index + 1} <span class="badge">unlocked</span>`;
            makeOpenButton();
            updateMeta();
          } else {
            // still not enough coins; keep disabled state updated
            button.disabled = true;
          }
        };
      } else {
        makeOpenButton();
      }

      footer.appendChild(title);
      footer.appendChild(button);
      card.appendChild(envelope);
      card.appendChild(footer);
      grid.appendChild(card);
    });

    updateMeta();
  }

  // Reset Button: reset BOTH coins and letter purchases
  document.getElementById('reset').addEventListener('click', () => {
    if (confirm('reset progress? (coins and letters will reset)')) {
      localStorage.removeItem('ldg_coins');
      localStorage.removeItem('ldg_purchases');
      location.reload();
    }
  });

  // Keep HUD and buy buttons responsive if coins change from other tabs/pages
  window.addEventListener('storage', (e) => {
    if (e.key === 'ldg_coins') {
      const hud=document.getElementById('coinCount');
      if (hud) hud.textContent = String(parseInt(localStorage.getItem('ldg_coins')||'0',10));
      // re-render to refresh button disabled states
      render();
    }
  });

  // Initial render
  render();
})();
</script>

<script>
  (function(){
    function u(){ var el=document.getElementById('coinCount'); if(el){ el.textContent=String(parseInt(localStorage.getItem('ldg_coins')||'0',10)); } }
    u(); window.addEventListener('storage', u);
  })();
</script>
</body>
</html>
